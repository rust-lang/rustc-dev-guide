<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Parameter types/consts/regions - Rust Compiler Development Guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="A guide to developing the Rust compiler (rustc)">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../pagetoc.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust Compiler Development Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rustc-dev-guide" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rustc-dev-guide/edit/main/src/ty_module/param_ty_const_regions.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="parameter-tyconstregions"><a class="header" href="#parameter-tyconstregions">Parameter <code>Ty</code>/<code>Const</code>/<code>Region</code>s</a></h1>
<p>When inside of generic items, types can be written that use in scope generic parameters, for example <code>fn foo&lt;'a, T&gt;(_: &amp;'a Vec&lt;T&gt;)</code>. In this specific case
the <code>&amp;'a Vec&lt;T&gt;</code> type would be represented internally as:</p>
<pre><code>TyKind::Ref(
  RegionKind::LateParam(DefId(foo), DefId(foo::'a), "'a"),
  TyKind::Adt(Vec, &amp;[TyKind::Param("T", 0)])
)
</code></pre>
<p>There are three separate ways we represent usages of generic parameters:</p>
<ul>
<li><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/type.TyKind.html#variant.Param"><code>TyKind::Param</code></a>/<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/type.ConstKind.html#variant.Param"><code>ConstKind::Param</code></a>/<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/type.RegionKind.html#variant.ReEarlyParam"><code>RegionKind::EarlyParam</code></a> for early bound generic parameters (note: all type and const parameters are considered early bound, see the <a href="../early_late_parameters.html">chapter on early vs late bound parameters</a> for more information)</li>
<li><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/type.TyKind.html#variant.Bound"><code>TyKind::Bound</code></a>/<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/type.ConstKind.html#variant.Bound"><code>ConstKind::Bound</code></a>/<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/type.RegionKind.html#variant.ReBound"><code>RegionKind::Bound</code></a> for references to parameters introduced via higher ranked bounds or higher ranked types i.e. <code>for&lt;'a&gt; fn(&amp;'a u32)</code> or <code>for&lt;'a&gt; T: Trait&lt;'a&gt;</code>. This is discussed in the <a href="./binders.html">chapter on <code>Binder</code>s</a>.</li>
<li><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/type.RegionKind.html#variant.ReLateParam"><code>RegionKind::LateParam</code></a> for late bound lifetime parameters, <code>LateParam</code> is discussed in the <a href="./instantiating_binders.html">chapter on instantiating <code>Binder</code>s</a>.</li>
</ul>
<p>This chapter only covers <code>TyKind::Param</code> <code>ConstKind::Param</code> and <code>RegionKind::EarlyParam</code>.</p>
<h2 id="tyconst-parameters"><a class="header" href="#tyconst-parameters">Ty/Const Parameters</a></h2>
<p>As <code>TyKind::Param</code> and <code>ConstKind::Param</code> are implemented identically this section only refers to <code>TyKind::Param</code> for simplicity.
However you should keep in mind that everything here also is true of <code>ConstKind::Param</code></p>
<p>Each <code>TyKind::Param</code> contains two things: the name of the parameter and an index.</p>
<p>See the following concrete example of a usage of <code>TyKind::Param</code>:</p>
<pre><code class="language-rust ignore">struct Foo&lt;T&gt;(Vec&lt;T&gt;);</code></pre>
<p>The <code>Vec&lt;T&gt;</code> type is represented as <code>TyKind::Adt(Vec, &amp;[GenericArgKind::Type(Param("T", 0))])</code>.</p>
<p>The name is somewhat self explanatory, it's the name of the type parameter. The index of the type parameter is an integer indicating
its order in the list of generic parameters in scope (note: this includes parameters defined on items on outer scopes than the item the parameter is defined on). Consider the following examples:</p>
<pre><code class="language-rust ignore">struct Foo&lt;A, B&gt; {
  // A would have index 0
  // B would have index 1

  .. // some fields
}
impl&lt;X, Y&gt; Foo&lt;X, Y&gt; {
  fn method&lt;Z&gt;() {
    // inside here, X, Y and Z are all in scope
    // X has index 0
    // Y has index 1
    // Z has index 2
  }
}</code></pre>
<p>Concretely given the <code>ty::Generics</code> for the item the parameter is defined on, if the index is <code>2</code> then starting from the root <code>parent</code>, it will be the third parameter to be introduced. For example in the above example, <code>Z</code> has index <code>2</code> and is the third generic parameter to be introduced, starting from the <code>impl</code> block.</p>
<p>The index fully defines the <code>Ty</code> and is the only part of <code>TyKind::Param</code> that matters for reasoning about the code we are compiling.</p>
<p>Generally we do not care what the name is and only use the index. The name is included for diagnostics and debug logs as otherwise it would be
incredibly difficult to understand the output, i.e. <code>Vec&lt;Param(0)&gt;: Sized</code> vs <code>Vec&lt;T&gt;: Sized</code>. In debug output, parameter types are
often printed out as <code>{name}/#{index}</code>, for example in the function <code>foo</code> if we were to debug print <code>Vec&lt;T&gt;</code> it would be written as <code>Vec&lt;T/#0&gt;</code>.</p>
<p>An alternative representation would be to only have the name, however using an index is more efficient as it means we can index into <code>GenericArgs</code> when instantiating generic parameters with some arguments. We would otherwise have to store <code>GenericArgs</code> as a <code>HashMap&lt;Symbol, GenericArg&gt;</code> and do a hashmap lookup everytime we used a generic item.</p>
<p>In theory an index would also allow for having multiple distinct parameters that use the same name, e.g.
<code>impl&lt;A&gt; Foo&lt;A&gt; { fn bar&lt;A&gt;() { .. } }</code>.
The rules against shadowing make this difficult but those language rules could change in the future.</p>
<h3 id="lifetime-parameters"><a class="header" href="#lifetime-parameters">Lifetime parameters</a></h3>
<p>In contrast to <code>Ty</code>/<code>Const</code>'s <code>Param</code> singular <code>Param</code> variant, lifetimes have two variants for representing region parameters: <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/type.RegionKind.html#variant.ReEarlyParam"><code>RegionKind::EarlyParam</code></a> and <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/type.RegionKind.html#variant.ReLateParam"><code>RegionKind::LateParam</code></a>. The reason for this is due to function's distinguishing between <a href="../early_late_parameters.html">early and late bound parameters</a> which is discussed in an earlier chapter (see link).</p>
<p><code>RegionKind::EarlyParam</code> is structured identically to <code>Ty/Const</code>'s <code>Param</code> variant, it is simply a <code>u32</code> index and a <code>Symbol</code>. For lifetime parameters defined on non-function items we always use <code>ReEarlyParam</code>. For functions we use <code>ReEarlyParam</code> for any early bound parameters and <code>ReLateParam</code> for any late bound parameters. Note that just like <code>Ty</code> and <code>Const</code> params we often debug format them as <code>'SYMBOL/#INDEX</code>, see for example:</p>
<pre><code class="language-rust ignore">// This function would have its signature represented as:
//
// ```
// fn(
//     T/#2,
//     Ref('a/#0, Ref(ReLateParam(...), u32))
// ) -&gt; Ref(ReLateParam(...), u32)
// ```
fn foo&lt;'a, 'b, T: 'a&gt;(one: T, two: &amp;'a &amp;'b u32) -&gt; &amp;'b u32 {
    ...
}</code></pre>
<p><code>RegionKind::LateParam</code> is discussed more in the chapter on <a href="./instantiating_binders.html">instantiating binders</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../ty_module/generic_arguments.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../ty-fold.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../ty_module/generic_arguments.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../ty-fold.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>
        <script src="../pagetoc.js"></script>



    </div>
    </body>
</html>
